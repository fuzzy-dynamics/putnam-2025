# Putnam 2025 A5 - Solution

## Answer

**The sequences $s$ that maximize $f(s)$ are exactly the two alternating sequences:**

$$s^+ = (+1, -1, +1, -1, \ldots) \quad \text{and} \quad s^- = (-1, +1, -1, +1, \ldots)$$

both of length $n-1$.

## Solution

### Setup

The condition $s_i(a_{i+1} - a_i) > 0$ means:
- If $s_i = +1$: $a_{i+1} > a_i$ (ascent)
- If $s_i = -1$: $a_{i+1} < a_i$ (descent)

### Key Symmetry

**Lemma:** For any sequence $s = (s_1, \ldots, s_{n-1})$, define $s' = (-s_1, \ldots, -s_{n-1})$. Then $f(s) = f(s')$.

*Proof:* Consider the bijection $\sigma: (a_1, \ldots, a_n) \mapsto (n+1-a_1, \ldots, n+1-a_n)$ on permutations of $\{1, \ldots, n\}$. This map sends ascents to descents and vice versa:
$$a_{i+1} > a_i \iff (n+1-a_{i+1}) < (n+1-a_i)$$

Thus $(a_1, \ldots, a_n)$ satisfies the constraints for $s$ if and only if $\sigma(a_1, \ldots, a_n)$ satisfies the constraints for $s'$.

### Reformulation

Since $f(s) = f(s')$, maximizing $f(s)$ is equivalent to maximizing $f(s) + f(s')$ (as this sum equals $2f(s)$ for any maximizer).

**Counting Scheme:** To compute $f(s) + f(s')$, we count permutations valid for either $s$ or $s'$:

1. **Place the maximum:** Choose position $i \in \{1, \ldots, n\}$ for the element $n$
2. **Check compatibility:** Determine if $s$ or $s'$ allows $n$ at position $i$
3. **Recurse:** Split remaining elements into left/right groups and fill according to the induced subsequences

### When Can $n$ Occupy Position $i$?

For $n$ at position $i$, all neighbors must be smaller (since $n$ is maximal). This forces:
- If $i > 1$: need $a_i > a_{i-1}$, so $s_{i-1} = +1$ (for $s$) or $s'_{i-1} = +1$ i.e. $s_{i-1} = -1$ (for $s'$)
- If $i < n$: need $a_i > a_{i+1}$, so $s_i = -1$ (for $s$) or $s'_i = -1$ i.e. $s_i = +1$ (for $s'$)

**Observation:** Position $i$ is valid for $s$ iff it satisfies: ($i = 1$ or $s_{i-1} = +1$) and ($i = n$ or $s_i = -1$).

Position $i$ is valid for $s'$ iff: ($i = 1$ or $s_{i-1} = -1$) and ($i = n$ or $s_i = +1$).

### Main Theorem

**Theorem:** $f(s)$ is maximized exactly when $s$ is alternating.

*Proof by strong induction on $n$:*

**Base cases:** For $n \leq 2$, all sequences achieve $f = 1$.

**Inductive step:** Let $s^+ = (+1, -1, +1, \ldots)$ and $s^- = (-1, +1, \ldots)$ be the alternating sequences. Note $(s^+)' = s^-$.

We show the pair $(s^+, s^-)$ maximizes $f(s) + f(s')$.

**Claim 1:** For alternating $(s^+, s^-)$, every position $i \in \{1, \ldots, n\}$ is valid for exactly one of $s^+$ or $s^-$.

*Proof:* The valid positions for $s^+$ are where $s^+_{i-1} = +1$ (or $i=1$) and $s^+_i = -1$ (or $i=n$). For alternating $s^+$, these are the "local maxima" positions. Similarly for $s^-$. Since $s^+$ and $s^-$ have opposite signs everywhere, their valid positions partition $\{1, \ldots, n\}$.

**Claim 2:** The subsequences induced by placing $n$ at any valid position remain alternating.

*Proof:* Removing one element from an alternating sequence and restricting to either side preserves the alternating property.

**Claim 3:** Non-alternating sequences achieve strictly smaller $f(s) + f(s')$.

*Proof:* Suppose $s$ has a "run": consecutive equal signs $s_i = s_{i+1}$ for some $i \in \{1, \ldots, n-2\}$.

Recall: position $j$ is valid for placing element $n$ in $s$ iff ($j = 1$ or $s_{j-1} = +1$) AND ($j = n$ or $s_j = -1$).

**Case $s_i = s_{i+1} = +1$:** Consider position $j = i+1$ (where $2 \leq i+1 \leq n-1$).
- For $s$: Need $s_i = +1$ ✓ AND $s_{i+1} = -1$ ✗ (it's $+1$). Invalid for $s$.
- For $s'$: Need $s'_i = +1$ ✗ (it's $-1$) AND $s'_{i+1} = -1$ ✗. Invalid for $s'$.

**Case $s_i = s_{i+1} = -1$:** Consider position $j = i+1$.
- For $s$: Need $s_i = +1$ ✗ (it's $-1$). Invalid for $s$.
- For $s'$: Need $s'_i = +1$ ✓ AND $s'_{i+1} = -1$ ✗ (it's $+1$). Invalid for $s'$.

In both cases, position $i+1$ is invalid for **both** $s$ and $s'$. Thus the set of valid positions across $(s, s')$ has size at most $n-1 < n$.

**Recursive argument:** The count $f(s) + f(s')$ satisfies:
$$f(s) + f(s') = \sum_{j \text{ valid for } s \text{ or } s'} \binom{n-1}{j-1} \cdot [f(s_L) + f(s'_L)] \cdot [f(s_R) + f(s'_R)]$$

where $s_L, s_R$ are the induced subsequences. For alternating $s$, all $n$ positions contribute, and $s_L, s_R$ remain alternating. For non-alternating $s$, at least one position is missing, AND some induced subsequences may be non-alternating (reducing their contribution by induction).

By strong induction on $n$, $f(s) + f(s') < f(s^+) + f(s^-)$ whenever $s$ is non-alternating.

**Uniqueness:** The above shows equality requires all positions valid and all subsequences alternating, which forces $s$ to be alternating.

### Conclusion

The maximum is achieved exactly by $s^+ = (+1, -1, +1, \ldots)$ and $s^- = (-1, +1, -1, \ldots)$.

## Illustration

| $n$ | Max $f(s)$ | Maximizers |
|-----|------------|------------|
| 2   | 1          | $(+), (-)$ |
| 3   | 2          | $(+,-), (-,+)$ |
| 4   | 5          | $(+,-,+), (-,+,-)$ |
| 5   | 16         | $(+,-,+,-), (-,+,-,+)$ |
| 6   | 61         | $(+,-,+,-,+), (-,+,-,+,-)$ |

These maximum values are the **Euler zigzag numbers** (OEIS A000111), which count alternating permutations.
